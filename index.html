<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Minesweeper game</title>
    <style type="text/css">

        /* Generated by Font Squirrel (https://www.fontsquirrel.com) on September 12, 2016 */
        @font-face {
            font-family: 'digital-7';
            src: url('assets/fonts/digital-7/digital-7.mono.eot');
            src: url('assets/fonts/digital-7/digital-7.mono.eot?#iefix') format('embedded-opentype'),
                 url('assets/fonts/digital-7/digital-7.mono.woff2') format('woff2'),
                 url('assets/fonts/digital-7/digital-7.mono.woff') format('woff'),
                 url('assets/fonts/digital-7/digital-7.mono.ttf') format('truetype'),
                 url('assets/fonts/digital-7/digital-7.mono.svg#digital-7_monomono') format('svg');
            font-weight: normal;
            font-style: normal;
        }

        /* Custom styles */
        dl {
            border:2px solid white;
            border-left-color:#7b7b7b;
            border-top-color:#7b7b7b;
            margin:0;
            min-height:26px;
            padding:3px 6px;
            position:relative;
            text-align:center;
        }
        dd {
            margin:0;
        }
        .show-for-sr {
            left: -999em;
            position: absolute;
            top: -999em;
        }
        .health-status {
            border:1px solid #7b7b7b;
            border-bottom-width:0;
            border-right-width:0;
            height:24px;
            margin:0 auto;
            width:24px;
        }
        .health-status button {
            background:transparent url('assets/img/sprite.png') no-repeat 1px -27px;
            border:2px solid white;
            border-bottom-color:#7b7b7b;
            border-right-color:#7b7b7b;
            margin:0 auto;
            height:25px;
            width: 25px;
        }
        .health-status button:focus {
            outline:none;
        }
        .health-status button:active {
            border:1px solid #7b7b7b;
            outline:none;
        }
        .health-status .dead {
            background-position-x:-43px;
        }
        .health-status .anxious {
            background-position-x:-21px;
        }
        .health-status .safe {
            background-position-x:-65px;
        }
        .digital {
            background:#000;
            color:#ff0000;
            font-family: 'digital-7';
            font-size:29px;
            line-height:.8;
        }
        .mines-remaining {
            left:6px;
            position:absolute;
            top:4px;
        }
        .time-taken {
            position:absolute;
            right:6px;
            top:4px;
        }
        section {
            background:#bdbdbd;
            border:2px solid white;
            border-bottom-color:#7b7b7b;
            border-right-color:#7b7b7b;
            display:inline-block;
            padding:6px;
        }
        table {
            border:2px solid white;
            border-left-color:#7b7b7b;
            border-spacing: 0;
            border-top-color:#7b7b7b;
        }
        td {
            background:#bdbdbd url('assets/img/sprite.png') no-repeat 15px 0;
            border: 1px solid #7b7b7b;
            border-width:1px 0 0 1px;
            height:15px;
            padding:0;
            width:15px;
        }
        .covered {
            background-image: none;
            border-width:2px;
            border-top-color:#fff;
            border-left-color:#fff;
            height:12px;
            width:12px;
        }
        .next-to-one-mine {
            background-position-x:0;
        }
        .next-to-two-mines {
            background-position-x:-15px;
        }
        .next-to-three-mines {
            background-position-x:-30px;
        }
        .next-to-four-mines {
            background-position-x:-45px;
        }
        .next-to-five-mines {
            background-position-x:-60px;
        }
        .next-to-six-mines {
            background-position-x:-75px;
        }
        .next-to-seven-mines {
            background-position:0 -15px;
        }
        .next-to-eight-mines {
            background-position:-15px -15px;
        }
        .mine-marked {
            background-position:-30px -15px;
        }
        .mine-possibility {
            background-position:-45px -15px;
        }
        .mine-triggered {
            background-position:-60px -15px;
        }
        .mine {
            background-position:-75px -15px;
        }
    </style>
</head>
<body>
    <h1>Minesweeper</h1>
    <section>
        <dl>
            <dt class="show-for-sr">Mines remaining</dt>
                <dd class="digital mines-remaining">099</dd>
            <dt class="show-for-sr">Game Status</dt>
                <dd class="health-status">
                    <button>
                        <span class="show-for-sr">Alive</span>
                    </button>
                </dd>
            <dt class="show-for-sr">Time taken</dt>
                <dd class="digital time-taken">000<span class="show-for-sr"> seconds</span></dd>
        </dl>
        <table>
            <thead class="show-for-sr">
                <tr>
                    <th></th>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 4</th>
                    <th>Column 5</th>
                    <th>Column 6</th>
                    <th>Column 7</th>
                    <th>Column 8</th>
                    <th>Column 9</th>
                    <th>Column 10</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th class="show-for-sr">Row 1</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 2</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 3</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 4</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 5</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 6</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 7</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 8</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 9</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
                <tr>
                    <th class="show-for-sr">Row 10</th>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                    <td class="covered"><span class="show-for-sr">Covered</span></td>
                </tr>
            </tbody>
        </table>
    </section>
    <script type="text/javascript" src="node_modules/joose-utils/js/joose-utils.min.js"></script>
    <script type="text/javascript">

        // set config
        var config = {
            columns: 10,
            rows: 10
        }

        // game status :::::: TO MAKE PRIVATE
        var gameStatus = {
            health: 'alive',
            numberOfMines: 10,
            board: [
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty'],
                ['empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty', 'empty']
            ]
        };

        // bind elements
        var gameTable = document.querySelector('table');
        var tableCells = document.querySelectorAll('td');
        var gameButton = document.querySelector('.health-status button');

        // generate a random number between 0 and max supplied
        var getRandomNumber = function(max) {
            return (Math.floor(Math.random() * max));
        };
        
        // assign a state to a table cell
        var assignStates = function(state, limit) {

            var coordinates = [];

            for (var i=1; i<=limit; i++) {

                var x = getRandomNumber(config.columns);
                var y = getRandomNumber(config.rows);

                gameStatus.board[x][y] = state;

                coordinates.push([x, y])

            }

            return coordinates;

        }

        var cellPositionsToCheck = [
            [-1, -1],
            [0, -1],
            [1, -1],
            [-1, 0],
            // [0, 0] // this is the mine
            [1, 0],
            [-1, 1],
            [0, 1],
            [1, 1]
        ];

        var getSurroundingCells = function(sourceCells) {

            var cellsToCheck = []

            sourceCells.forEach(function(sourceCell, index) {
                
                var x = sourceCell[0];
                var y = sourceCell[1];
                
                cellPositionsToCheck.forEach(function(cell, index) {
                    var xToCheck = x + cell[0];
                    var yToCheck = y + cell[1];
                    if (xToCheck > -1 && xToCheck < config.columns && yToCheck > -1 && yToCheck < config.rows) {
                        cellsToCheck.push([xToCheck, yToCheck]);
                    }
                })

            });

            return cellsToCheck;

        }

        var assignIndicators = function(mines) {

            var indicativeCells = getSurroundingCells(mines);

            indicativeCells.forEach(function(cell, index) {
                var x = cell[0];
                var y = cell[1];
                if (gameStatus.board[x][y] !== 'mine') {
                
                    // check surrounding cells for other mines
                    var surroundingCells = getSurroundingCells([[x, y]]);
                    var mineCount = 0;
                    var classText = '';

                    surroundingCells.forEach(function(surroundingCell, index) {
                        if (gameStatus.board[surroundingCell[0]][surroundingCell[1]] === 'mine') {
                            mineCount++;
                        }
                    });

                    switch (mineCount) {
                        case 8:
                            classText = 'next-to-eight-mines';
                            break;
                        case 7:
                            classText = 'next-to-seven-mines';
                            break;
                        case 6:
                            classText = 'next-to-six-mines';
                            break;
                        case 5:
                            classText = 'next-to-five-mines';
                            break;
                        case 4:
                            classText = 'next-to-four-mines';
                            break;
                        case 3:
                            classText = 'next-to-three-mines';
                            break;
                        case 2:
                            classText = 'next-to-two-mines';
                            break;
                        case 1:
                        default:
                            classText = 'next-to-one-mine';
                            break;
                    }

                    // assign state
                    gameStatus.board[x][y] = classText;
                }
                
                // set state / indicator
            })
        };

        var renderBoard = function() {
            for (var i=1; i<=gameStatus.board.length; i++) {
                for (var j=1; j<=gameStatus.board[0].length; j++) {
                    joose.utils.addClass(gameTable.querySelector('tr:nth-child(' + i + ') td:nth-child(' + (j + 1) + ')'), gameStatus.board[i-1][j-1]);
                }
            }
        }

        var assignEvents = function() {
            tableCells.forEach(function(tableCell, index) {
                tableCell.addEventListener('click', function() {
                    joose.utils.removeClass(event.target, 'covered');
                });
            });
        };

        // setup a new game
        var setupNewGame = function() {
            var mines = assignStates('mine', gameStatus.numberOfMines);
            assignIndicators(mines);
            renderBoard();
            assignEvents();
        };

        // bind events
        gameButton.addEventListener('click', setupNewGame);

        // initialise new game on page load
        setupNewGame();

    </script>
</body>
</html>