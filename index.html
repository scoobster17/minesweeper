<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Minesweeper game</title>
    <style type="text/css">

        /* Generated by Font Squirrel (https://www.fontsquirrel.com) on September 12, 2016 */
        @font-face {
            font-family: 'digital-7';
            src: url('assets/fonts/digital-7/digital-7.mono.eot');
            src: url('assets/fonts/digital-7/digital-7.mono.eot?#iefix') format('embedded-opentype'),
                 url('assets/fonts/digital-7/digital-7.mono.woff2') format('woff2'),
                 url('assets/fonts/digital-7/digital-7.mono.woff') format('woff'),
                 url('assets/fonts/digital-7/digital-7.mono.ttf') format('truetype'),
                 url('assets/fonts/digital-7/digital-7.mono.svg#digital-7_monomono') format('svg');
            font-weight: normal;
            font-style: normal;
        }

        /* Custom styles */
        dl {
            border:2px solid white;
            border-left-color:#7b7b7b;
            border-top-color:#7b7b7b;
            margin:0;
            min-height:26px;
            padding:3px 6px;
            position:relative;
            text-align:center;
        }
        dd {
            margin:0;
        }
        .show-for-sr {
            left: -999em;
            position: absolute;
            top: -999em;
        }
        .health-status {
            border:1px solid #7b7b7b;
            border-bottom-width:0;
            border-right-width:0;
            height:24px;
            margin:0 auto;
            width:24px;
        }
        .health-status button {
            background:transparent url('assets/img/sprite.png') no-repeat 1px -27px;
            border:2px solid white;
            border-bottom-color:#7b7b7b;
            border-right-color:#7b7b7b;
            margin:0 auto;
            height:25px;
            width: 25px;
        }
        .health-status button:focus {
            outline:none;
        }
        .health-status button:active {
            border:1px solid #7b7b7b;
            outline:none;
        }
        .health-status .dead {
            background-position-x:-43px;
        }
        .health-status .anxious {
            background-position-x:-21px;
        }
        .health-status .safe {
            background-position-x:-65px;
        }
        .digital {
            background:#000;
            color:#ff0000;
            font-family: 'digital-7';
            font-size:29px;
            line-height:.8;
        }
        .mines-remaining {
            left:6px;
            position:absolute;
            top:4px;
        }
        .time-taken {
            position:absolute;
            right:6px;
            top:4px;
        }
        section {
            background:#bdbdbd;
            border:2px solid white;
            border-bottom-color:#7b7b7b;
            border-right-color:#7b7b7b;
            display:inline-block;
            padding:6px;
        }
        table {
            border:2px solid white;
            border-left-color:#7b7b7b;
            border-spacing: 0;
            border-top-color:#7b7b7b;
        }
        td {
            background:#bdbdbd url('assets/img/sprite.png') no-repeat 15px 0;
            border: 1px solid #7b7b7b;
            border-width:1px 0 0 1px;
            height:15px;
            padding:0;
            width:15px;
        }
        .covered {
            background-image: none;
            border-width:2px;
            border-top-color:#fff;
            border-left-color:#fff;
            height:12px;
            width:12px;
        }
        .next-to-one-mine {
            background-position-x:0;
        }
        .next-to-two-mines {
            background-position-x:-15px;
        }
        .next-to-three-mines {
            background-position-x:-30px;
        }
        .next-to-four-mines {
            background-position-x:-45px;
        }
        .next-to-five-mines {
            background-position-x:-60px;
        }
        .next-to-six-mines {
            background-position-x:-75px;
        }
        .next-to-seven-mines {
            background-position:0 -15px;
        }
        .next-to-eight-mines {
            background-position:-15px -15px;
        }
        .covered.mine-marked {
            background:#bdbdbd url('assets/img/sprite.png') no-repeat -30px -15px;
        }
        .covered.mine-possibility {
            background:#bdbdbd url('assets/img/sprite.png') no-repeat -45px -15px;
        }
        .mine-defused {
            background-position:-60px -15px;
        }
        .mine-triggered {
            background-color: #ff0000;
            background-position:-75px -15px;
        }
        .mine {
            background-position:-75px -15px;
        }
    </style>
</head>
<body>
    <h1>Minesweeper</h1>
    <form id="gameConfig">
        <label for="columns">Columns</label>
        <input type="number" name="columns" id="columns" value="10" min="8" max="99" />
        <label for="rows">Rows</label>
        <input type="number" name="rows" id="rows" value="10" min="1" max="99" />
        <label for="mines">Mines</label>
        <input type="number" name="mines" id="mines" value="10" />
        <input type="submit" value="Create board" />
    </form>
    <section>
        <dl>
            <dt class="show-for-sr">Mines remaining</dt>
                <dd class="digital mines-remaining">099</dd>
            <dt class="show-for-sr">Game Status</dt>
                <dd class="health-status">
                    <button>
                        <span class="show-for-sr">Alive</span>
                    </button>
                </dd>
            <dt class="show-for-sr">Time taken</dt>
                <dd class="digital time-taken">000<span class="show-for-sr"> seconds</span></dd>
        </dl>
        <table>
            <thead class="show-for-sr">
                <tr>
                    <th scope="col">Row numbers</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <table id="table2">
            <thead>
                <tr></tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </section>
    <script type="text/javascript" src="node_modules/joose-utils/js/joose-utils.min.js"></script>
    <script type="text/javascript">

        // set config
        var config = {
            contents: {
                "mine": "mine",
                "next-to-1": "next-to-one-mine",
                "next-to-2": "next-to-two-mines",
                "next-to-3": "next-to-three-mines",
                "next-to-4": "next-to-four-mines",
                "next-to-5": "next-to-five-mines",
                "next-to-6": "next-to-six-mines",
                "next-to-7": "next-to-seven-mines",
                "next-to-8": "next-to-eight-mines"
            }
        }

        var Tile = function() {
            this.contents = 'empty';
            this.covered = true;
            this.mark;
            this.defused = false;
            this.exploded = false;
        }

        Tile.prototype = {

            // getters
            getContents: function() {
                return this.contents;
            },
            getMark: function() {
                return this.contents;
            },
            getIsCovered: function() {
                return this.covered;
            },
            getIsDefused: function() {
                return this.defused;
            },
            getHasExploded: function() {
                return this.exploded;
            },

            // setters
            setContents: function(contents) {
                this.contents = contents;
            },
            setMark: function(type) {
                this.mark = type;
            },
            setAsUncovered: function() {
                this.covered = false;
            },
            setAsDefused: function() {
                this.defused = true;
            },
            setAsExploded: function() {
                this.exploded = true;
            }
        }

        // game status :::::: TO MAKE PRIVATE
        var gameStatus = {
            health: 'alive',
            numberOfMines: 10,
            board: [],
            noOfColumns: 10,
            noOfRows: 10,
            noOfMines: 10
        };

        // bind elements
        var gameTableBody = document.querySelector('tbody');
        var gameButton = document.querySelector('.health-status button');
        var gameBoardHeaderRow = document.querySelector('thead tr');
        var noOfColumns = document.getElementById('columns').value || config.noOfColumns;
        var noOfRows = document.getElementById('rows').value || config.noOfRows;
        var noOfMines = document.getElementById('mines').value || config.noOfMines;

        // generate a random number between 0 and max supplied
        var getRandomNumber = function(max) {
            return (Math.floor(Math.random() * max));
        };
        
        var assignNoOfRowsAndColumns = function() {
            
            var row = [];

            for (var i=1; i<=noOfRows; i++) {
                row.push(new Tile());
            }

            for (var j=1; j<=noOfRows; j++) {
                gameStatus.board.push(row);
            }

        };

        var assignMines = function() {

            var mines = []

            for (var i=1; i<=noOfMines; i++) {

                var mineX = getRandomNumber(noOfColumns);

                var mineY = getRandomNumber(noOfRows);

                // gameStatus.board[mineY][mineX].setContents(config.contents.mine);
                mines.push(
                    [mineX, mineY]
                )
            }

            console.log(mines);

            mines.forEach(function(mine) {
                gameStatus.board[mineX][mineY].setContents(config.contents.mine);
            });

        }

        var renderTableHeader = function() {
            for (var i=1; i<=noOfColumns; i++) {
                var th = document.createElement('th');
                th.setAttribute('scope', 'col');
                th.innerHTML = 'Column ' + i;
                gameBoardHeaderRow.appendChild(th);
            }
        }

        var renderTableBody = function() {

            for (var i=1; i<=noOfRows; i++) {
                
                var tr = document.createElement('tr');

                var th = document.createElement('th');
                th.setAttribute('scope', 'row');
                th.setAttribute('class', 'show-for-sr');
                th.innerHTML = 'Row ' + i;

                tr.appendChild(th);

                for (var j=1; j<=noOfColumns; j++) {
            
                    var tileValue = gameStatus.board[i-1][j-1].getContents();

                    var td = document.createElement('td');
                    td.setAttribute('class', tileValue);
                    td.innerHTML = [
                        '<span class="show-for-sr">',
                            tileValue,
                        '</span>'
                    ].join('');

                    tr.appendChild(td);

                }

                gameTableBody.appendChild(tr);

            }
        };

        var renderBoard = function() {
            renderTableHeader();
            renderTableBody();
        };

        // setup a new game
        var setupNewGame = function() {

            assignNoOfRowsAndColumns();

            assignMines();

            // assignIndicators(mines);
            renderBoard();
            // assignEvents();

            // show game state visually (temp)
            // renderBoard(document.getElementById('table2'))
        };

        // bind events
        gameButton.addEventListener('click', setupNewGame);

        // initialise new game on page load
        setupNewGame();

        // for successful defusal
        // joose.utils.removeClass(document.querySelector('tr:nth-child(' + (row + 1) + ') td:nth-child(' + (column + 2) + ')'), 'mine');
        // joose.utils.addClass(document.querySelector('tr:nth-child(' + (row + 1) + ') td:nth-child(' + (column + 2) + ')'), 'mine-triggered');

    </script>
</body>
</html>